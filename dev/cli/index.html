<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Command-Line interface · MKtest.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://jmurga.github.io/MKtest.jl/cli/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MKtest.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Package Overview</span><ul><li><a class="tocitem" href="../analytical/">Analytical estimations</a></li><li><a class="tocitem" href="../data/">Processing data</a></li><li><a class="tocitem" href="../mk/">MK approaches</a></li></ul></li><li><span class="tocitem">Infering the rate and strength of adaptation</span><ul><li><a class="tocitem" href="../empirical/">Empirical estimation</a></li><li><a class="tocitem" href="../rates/">Rates</a></li><li><a class="tocitem" href="../input/">Input data</a></li><li><a class="tocitem" href="../summstat/">Summary statistics</a></li><li><a class="tocitem" href="../abc/">ABC inference</a></li><li><a class="tocitem" href="../multiple/">Multiple dataset</a></li></ul></li><li class="is-active"><a class="tocitem" href>Command-Line interface</a><ul class="internal"><li><a class="tocitem" href="#Estimating-rates"><span>Estimating rates</span></a></li></ul></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Command-Line interface</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Command-Line interface</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jmurga/MKtest.jl/blob/master/docs/src/cli.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Command-Line-Interface"><a class="docs-heading-anchor" href="#Command-Line-Interface">Command-Line Interface</a><a id="Command-Line-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Command-Line-Interface" title="Permalink"></a></h1><p>We develop a Command-Line Interface (CLI) in case you want to avoid Julia interpreter. You can easly download <a href="https://raw.githubusercontent.com/jmurga/MKtest.jl/master/scripts/abcmk_cli.jl">abcmk_cli.jl</a>. The CLI have different functions to perform the whole pipeline as explained in <a href="../empirical/">Infering the rate and strength of adaptation</a> section</p><pre><code class="language-bash hljs">julia abcmk_cli.jl  </code></pre><pre><code class="language-bash hljs">See --help of each command for usages  
  rates  
  data
  summaries  
  inference  </code></pre><p>To reproduce the examples you can follow the steps described at <a href="https://jmurga.github.io/MKtest.jl/dev/empirical/#Computational-pipeline-1">Empirical estimation</a> section</p><h2 id="Estimating-rates"><a class="docs-heading-anchor" href="#Estimating-rates">Estimating rates</a><a id="Estimating-rates-1"></a><a class="docs-heading-anchor-permalink" href="#Estimating-rates" title="Permalink"></a></h2><p>To perform the rate estimations you can use the function <code>rates</code> at the CLI. The function works simirarly to the function <a href="../reference/#MKtest.rates"><code>MKtest.rates</code></a>. You can check the argument at <a href="https://jmurga.github.io/MKtest.jl/dev/rates/#Estimating-fixation-and-polymorphic-rates-considering-generalized-model-of-selection-and-linkage-1">Rates</a> sectino or using the macro <code>@doc MKtest.rates</code> in the Julia interpreter.</p><pre><code class="language-julia hljs">julia abcmk_cli.jl rates --help
Function to solve fixation and polymorphic rates analitically. The function will create N random models from prior values. Use the arguments to defined the input range for each parameter.

If rho and/or theta are set to nothing, the function will input random values given the range 0.0005:0.0005:0.01. Otherwise you can fix the values.

If gL is set to nothing, the function will not account the role of the weakly selected alleles in the estimation.

If scheduler is set to threads the software will be run using multi-threading, not distributed computing. Please be sure you start up Julia using the same number of threads as the argument nprocs using the option julia -J nprocs

The function returns a HDF5 file containing models solved and rates. The rates will be used to compute summary statistics required at ABC.

Please check the documentation to get more info about models parameters or detailed arguments description https://jmurga.github.io/MKtest.jl/dev/cli/ to check model

Optional Arguments:
  --ne: Int64 (default: 1000)
  --samples: Int64 (default: 661)
  --alpha: String (default: 0.1,0.9)
  --gam-neg: String (default: -1000,-200)
  --gL: String (default: 5,10)
  --gH: String (default: 400,1000)
  --dac: String (default: 1,2,4,5,10,20,50,100,200,400,500,661,925,1000)
  --shape: Float64 (default: 0.184)
  --rho: String (default: nothing)
  --theta: String (default: nothing)
  --iterations: Int64 (default: 100000)
  --output: String (default: /home/jmurga/rates.jld2)
  --scheduler: String (default: local)
  --nprocs: Int64 (default: 1)</code></pre><p>If you are going to perform the estimation in a HPC, please set the variable <code>scheduler</code> using the name of the HPC task manager. By default the value is set to <code>local</code></p><pre><code class="language-bash hljs">time julia abcmk_cli.jl rates --samples 661 --gamNeg -2000,-200 --gL 1,10 --gH 200,2000 --rho 0.001 --theta 0.001 --solutions 100000 --output analysis/rates.jld2 --dac 1,2,4,5,10,20,50,100,200,400,500,661,925,1000 --nthreads 7 --scheduler local</code></pre><p>If you are going to perform the estimation in an laptop, please set the variable <code>scheduler</code> to <code>threads</code> and start julia using the same number of threads as defined in the variable <code>nprocs</code></p><pre><code class="language-bash hljs">nprocs=7
julia -t${nprocs} abcmk_cli.jl 

## Parse data into new folder
To estimate summary statistics, you need to provide empirical SFS and divergence files. As explained in section [data](data.md), you can directly parse TGP or DGN data using our module. Nonetheless, you can input any other SFS and divergence file.

The function ```data``` will create a folder containing TGP or DGN raw data, parsed SFS and divergence files. Otherwise you can specify an exisiting folder.
</code></pre><p>bash julia abcmk_cli.jl data –help</p><pre><code class="nohighlight hljs"></code></pre><p>bash julia abcmk<em>cli.jl data –analysis</em>folder analysis/ –gene<em>list analysis/dna</em>vips.txt</p><p>Function to parse polymorphic and divergence data from Uricchio et. al (2019) and Murga-Moreno et al (2019). Please input a path to create a new analysis folder. You can filter the dataset using a file containing a list of Ensembl IDs. </p><p>The function returns files containing raw polymorphic and divergence data, parsed SFS and parsed divegence required to estimate summary statistics.	</p><p>Please check the documentation to get more info https://jmurga.github.io/MKtest.jl/dev/cli/</p><p>Optional Arguments:   –analysis<em>folder: String (default: &lt;folder&gt;)   –dataset: String (default: tgp)   –gene</em>list: String (default: false)   –bins: String (default: false)</p><pre><code class="nohighlight hljs"></code></pre><p>bash julia abcmk<em>cli.jl data –analysis</em>folder analysis/</p><pre><code class="nohighlight hljs">
Remember you can use the argument ```gene_list``` to subset genes from TGP or DGN data using a list of Ensembl or Flybase ID. Please check [Multiple dataset](https://jmurga.github.io/MKtest.jl/dev/multiple/) to get more info.

## Estimate summary statistics

To estimate summary statistics, we used the estimated analytical rates and empirical data following the description at section [Empirical estimation](empirical.md).

</code></pre><p>bash julia abcmk_cli summaries –help</p><pre><code class="nohighlight hljs"></code></pre><p>bash julia abcmk<em>cli.jl summaries –analysis</em>folder analysis/ –rates analysis/rates.jld2 –samples 661 –dac 2,4,5,10,20,50,200,661,925 –summstatSize 1000000</p><p>Estimate summary statistics from analytical rates. You must provide a path containing the parsed SFS and divergence file.</p><p>The function returns files containing bootstrapped datasets (alphas.txt) and summary statistics (summstat.txt)</p><p>Check the documentation to get more info https://jmurga.github.io/MKtest.jl/dev/cli</p><p>Optional Arguments:   –analysis_folder: String (default: &lt;folder&gt;)   –rates: String (default: rates.jld2)   –ne: Int64 (default: 1000)   –samples: Int64 (default: 500)   –dac: String (default: 2,4,5,10,20,50,200,500,700)   –summstatSize: Int64 (default: 100000)   –replicas: Int64 (default: 100)   –bootstrap: String (default: true)   –scheduler: String (default: local)   –nthreads: Int64 (default: 1)</p><pre><code class="nohighlight hljs">
The function will output observed data bootstraped (*alphas.txt*) and summary statistics (*summaries.txt*) in the analysis_folder. These file will be used at ABC inference to generate posterior distributions.
</code></pre><p>bash julia abcmk<em>cli.jl summaries –analysis</em>folder analysis/ –rates  analysis/rates.jld2 –samples 661 –replicas 100 –summstatSize 100000 –dac 2,4,5,10,20,50,200,661,925</p><pre><code class="nohighlight hljs">
## Perform ABC inference
At this point, you have a folder containing summary statistics and observed data to perform ABC inference. As explained in our [home page](index.md), we performed the ABC inference using [ABCreg](https://github.com/molpopgen/ABCreg). However, you can used other ABC software to perform the inference.

We link [ABCreg](https://github.com/molpopgen/ABCreg) with Julia to perform ABC inference. If you are going to use ABCreg to make inferences from our software directly, please [cite the publication](https://doi.org/10.1186/1471-2156-10-35). Remember you need to install ABCreg before continue. Please check [home page](index.md) to install ABCreg.

It is possible to perform the inference through Julia. The function will output one file per bootstrapped replicas containing the posteriors distributions. We set the tolerance value to record 1000 values for the regression.  The posterior distributions contains five columns corresponding to:

 - α weak: Contribution of weak selecction to $\alpha$
 - α strong: Contribution of strong selecction to $\alpha$
 - α weak: Adaptation rate
 - γ: Negative selection coefficient
 - β: Negative selection coefficient

</code></pre><p>bash julia abcmk<em>cli.jl abcInference –analysis</em>folder analysis/ –S 9 –tol 0.01 –ABCreg /home/jmurga/ABCreg/src/reg</p><pre><code class="nohighlight hljs">
## Estimate Maximum-A-Posteriori and plot using R. 

Using julia expression, cannot input into *abcmk_cli.jl* (in development)

We used R to estimate the Maximum-A-Posteriori (MAP) from posterior distributions following ABCreg examples. We linked Julia and R internally. The module contains functions to perform the estimations without quit the Julia session.

If you will perform MAP estimates and plot using our module, be sure you have installed R and the following packages: ggplot2 and data.table, locfit. 
</code></pre><p>bash julia -e &#39;using MKtest, RCall, GZip, DataFrames, CSV;MKtest.sourcePlotMapR(script=&quot;analysis/script.jl&quot;); MKtest.plotMap(analysis_folder=&quot;analysis/&quot;);&#39; ``` </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../multiple/">« Multiple dataset</a><a class="docs-footer-nextpage" href="../reference/">Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.13 on <span class="colophon-date" title="Monday 22 August 2022 09:26">Monday 22 August 2022</span>. Using Julia version 1.8.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
