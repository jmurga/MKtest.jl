<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>MK approaches · MKtest.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://jmurga.github.io/MKtest.jl/mk/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MKtest.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Package Overview</span><ul><li><a class="tocitem" href="../analytical/">Analytical estimations</a></li><li><a class="tocitem" href="../data/">Processing data</a></li><li class="is-active"><a class="tocitem" href>MK approaches</a><ul class="internal"><li><a class="tocitem" href="#Standard-MKT"><span>Standard MKT</span></a></li><li><a class="tocitem" href="#Fay,-Waycoff-and-Wu-MK-extension"><span>Fay, Waycoff and Wu MK extension</span></a></li><li><a class="tocitem" href="#imputed-MKT-(in-preparation)"><span>imputed MKT (in preparation)</span></a></li><li><a class="tocitem" href="#Asymptotic-MKT"><span>Asymptotic MKT</span></a></li><li><a class="tocitem" href="#Grapes"><span>Grapes</span></a></li></ul></li></ul></li><li><span class="tocitem">Infering the rate and strength of adaptation</span><ul><li><a class="tocitem" href="../empirical/">Empirical estimation</a></li><li><a class="tocitem" href="../rates/">Rates</a></li><li><a class="tocitem" href="../input/">Input data</a></li><li><a class="tocitem" href="../summstat/">Summary statistics</a></li><li><a class="tocitem" href="../abc/">ABC inference</a></li></ul></li><li><a class="tocitem" href="../cli/">Command-Line interface</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Package Overview</a></li><li class="is-active"><a href>MK approaches</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>MK approaches</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jmurga/MKtest.jl/blob/master/docs/src/mk.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="MK-approaches"><a class="docs-heading-anchor" href="#MK-approaches">MK approaches</a><a id="MK-approaches-1"></a><a class="docs-heading-anchor-permalink" href="#MK-approaches" title="Permalink"></a></h1><p>We included other heuristic MK approaches in our module. All the functions use the formated SFS and divergence data described at <a href="../data/">data section</a>.</p><h2 id="Standard-MKT"><a class="docs-heading-anchor" href="#Standard-MKT">Standard MKT</a><a id="Standard-MKT-1"></a><a class="docs-heading-anchor-permalink" href="#Standard-MKT" title="Permalink"></a></h2><p>The standard McDonald &amp; Kreitman test ([McDonald and Kreitman, 1991]) was developed to be applied to protein coding sequences, combining both divergence (<span>$D$</span>) and polymorphism (<span>$P$</span>) sites, and categorizing mutations as synonymous (<span>$P_S$</span>, <span>$D_S$</span>) and non-synonymous (<span>$P_N$</span>, <span>$D_N$</span>). </p><p>If all mutations are either strongly deleterious or neutral, then <span>$Di/D0$</span> is expected to roughly equal <span>$Pi/P0$</span>. In contrast, if positive selection is operating in the region, adaptive mutations rapidly reach fixation and contribute more to divergence than polymorphism compared to neutral mutations, and then <span>$Di/D0 &gt; Pi/P0$</span>. Assuming that adaptive mutations contribute little to polymorphism but substantially to divergence, the proportion of non-synonymous substitutions is inferred following Smith and Eyre-Walker (2002).</p><p class="math-container">\[\alpha = 1 - (\frac{P_N}{P_S}\cdot\frac{D_S}{D_N})\]</p><p>Please check <a href="../reference/#MKtest.standardMK"><code>MKtest.standardMK</code></a> to obtain more info.</p><pre><code class="language-julia hljs">adap = MKtest.parameters(n=661,cutoff=[0.0,1.0])
alpha, sfs, divergence, m= MKtest.parse_sfs(adap, data = &quot;analysis/tgp.txt&quot;)

mk = MKtest.standardMK(sfs[1],divergence[1])</code></pre><h2 id="Fay,-Waycoff-and-Wu-MK-extension"><a class="docs-heading-anchor" href="#Fay,-Waycoff-and-Wu-MK-extension">Fay, Waycoff and Wu MK extension</a><a id="Fay,-Waycoff-and-Wu-MK-extension-1"></a><a class="docs-heading-anchor-permalink" href="#Fay,-Waycoff-and-Wu-MK-extension" title="Permalink"></a></h2><p><a href="[fwwMK](https:/doi.org/10.1038/4151024a)">Fay et al. (2002)</a> proposed an approach that removes all polymorphisms segregating at a frequency (<span>$j$</span>) below a given threshold (usually <span>$j &gt; 5\%–15\%$</span>). Although there is no consensus about what this threshold should be used, <a href="https://doi.org/10.1093/molbev/msn005">J. Charlesworth &amp; Eyre-Walker (2008)</a> demonstrated that  estimates are robust using a frequency threshold of 15%, below which most slightly deleterious polymorphisms are found and removed. The estimates are reasonably accurate only when the rate of adaptive evolution is high and the Distribution of Fitness Effects (DFE) of deleterious mutations is leptokurtic.</p><p class="math-container">\[\alpha = 1 - (\frac{P_{N (j&gt;15\%)}}{P_{S (j&gt;15\%)}\cdot\frac{D_S}{D_N})\]</p><p>Please check <a href="../reference/#MKtest.fwwMK"><code>MKtest.fwwMK</code></a> to obtain more info.</p><pre><code class="language-julia hljs">fww = MKtest.fwwMK(adap,sfs[1],divergence[1],cutoff=0.15)</code></pre><h2 id="imputed-MKT-(in-preparation)"><a class="docs-heading-anchor" href="#imputed-MKT-(in-preparation)">imputed MKT (in preparation)</a><a id="imputed-MKT-(in-preparation)-1"></a><a class="docs-heading-anchor-permalink" href="#imputed-MKT-(in-preparation)" title="Permalink"></a></h2><p>The imputed MKT (impMKT) is a modification of the Fay, Waycoff, and Wu MK extension (fwwMK) (<a href="[fwwMK](https:/doi.org/10.1038/4151024a)">Fay et al. (2002)</a> to improve gene-by-gene analyses. The method propose the imputation of slightly deleterious mutations at the SFS rather than removing all variants below a frequency threshold. The imputedMK aims to maximize the information to test the excess of divergence ratio relative to polymorphism at the gene level.</p><p class="math-container">\[\alpha\]</p><p>is estimated as</p><p class="math-container">\[\alpha_{imputed} = 1 - \left( \frac{P_{N} - P_{wd}}{P_{S}} \cdot \frac{D_{N}}{D_{S}} \right)\]</p><p>where <span>$P_{wd}$</span> is</p><p class="math-container">\[P_{wd} \approx P_{wd (j &lt; 15\%)} = P_{N (j&lt;15\%)} - \frac{P_{N (j&gt;15\%) } \cdot P_{S (j&lt;15\%)}}{P_{S (j&gt;15\%)}}\]</p><p>Please check <a href="../reference/#MKtest.imputedMK"><code>MKtest.imputedMK</code></a> to obtain more info.</p><pre><code class="language-julia hljs">imputed = MKtest.imputedMK(adap,sfs[1],divergence[1],cutoff=0.15)</code></pre><h2 id="Asymptotic-MKT"><a class="docs-heading-anchor" href="#Asymptotic-MKT">Asymptotic MKT</a><a id="Asymptotic-MKT-1"></a><a class="docs-heading-anchor-permalink" href="#Asymptotic-MKT" title="Permalink"></a></h2><p>Proposed by Messer and Petrov (2013). This extension is robust to the presence of selective sweeps (genetic hitchhiking) and the segregation of slightly deleterious polymorphisms substitutions (BGS). In this approach, the authors defined <span>$\alpha$</span> as a function that depends on the SFS of alleles. Therefore, <span>$\alpha$</span> is estimated in different frequency intervals (<span>$x$</span>), and these values are then adjusted to an exponential function. An exponential fit is suitable as the non-synonymous allele frequency is expected to decay exponentially over the respective levels of synonymous polymorphisms (Messer &amp; Petrov, 2013).</p><p class="math-container">\[\alpha\]</p><p>is estimated as</p><p class="math-container">\[\alpha_{fit(x)} = a+b \cdot e^{-cx}\]</p><p>Please check <a href="../reference/#MKtest.aMK"><code>MKtest.aMK</code></a> to obtain more info.</p><pre><code class="language-julia hljs">amk, ci, model = MKtest.aMK(adap,alpha[1])</code></pre><h2 id="Grapes"><a class="docs-heading-anchor" href="#Grapes">Grapes</a><a id="Grapes-1"></a><a class="docs-heading-anchor-permalink" href="#Grapes" title="Permalink"></a></h2><p>Grapes is a software ML models of the DFE that assume PRF framework can estimate the expected proportion of adaptive fixations given the inferred DFE from the MKT data. In such approaches, the expected levels of fixations and polymorphism are used to perform likelihood estimates, while considering different evolutionary models. ML estimations of the DFE have varied from the first models inferring constant selection parameters across all loci to including models with continuous distributions of both positive and negative selection coefficients \citep{bierne<em>genomic</em>2004, eyre-walker<em>distribution</em>2006, boyko<em>assessing</em>2008, eyre-walker<em>estimating</em>2009, galtier<em>adaptive</em>2016, racimo<em>approximation</em>2014, galtier<em>adaptive</em>2016, tataru<em>inference</em>2017, zhen<em>greater</em>2021}, correcting the aforementioned assumptions to calculate how many non-adaptive substitutions are expected to become fixed given the empirical DFE. </p><p>Notwithstanding, the newest and more sophisticated ML implementations \citep{galtier<em>adaptive</em>2016, tataru<em>inference</em>2017} take advantage of that proposed by \cite{eyre-walker<em>distribution</em>2006} and \cite{eyre-walker<em>estimating</em>2009}, which assumes that non-neutral deleterious mutations arise from a DFE in the form of a Gamma distribution. Nonetheless, unlike \cite{eyre-walker<em>distribution</em>2006}, these methods also model the effect of weakly advantageous alleles through an exponentially distributed function, where DFE is a mixture distribution between the gamma and exponential distributions. Therefore, the state-of-the-art methods usually follow a standard population genetic model based on PRF presented in \cite{galtier<em>adaptive</em>2016} and \cite{tataru<em>inference</em>2017} to later perform ML of the DFE. </p><p>To estimate the expected counts of polymorphism and divergence, the model considers a Wright-Fisher panmictic population of size <span>$N_e$</span>, which diverged in a time <span>$t$</span> where mutation occurs at a mutation rate <span>$\mu$</span>, per site per generation \citep{galtier<em>adaptive</em>2016}. Figure \ref{fig:dfe<em>prf} illustrate the equations defining the expected polymorphic and divergence counts. Let consider synonymous mutation as neutral (P</em>S<span>$) and non-synonymous mutation as selected ($</span>P_N<span>$), from PRF the expected counts given a frequency $i$</span> is estimated as</p><p>\begin{equation}\label{prf<em>ps} 	\mathbf{E}[P</em>{S[i]}] = \frac{4N<em>e \mu L</em>S}{i} \end{equation}</p><p>\begin{equation}\label{prf<em>pn} 	\mathbf{E}[P</em>{N[i]}] = 4N<em>e \mu L</em>N \int_{0}^{1} B(i,n,x) H(s,x)dx \end{equation}</p><p>\noindent where <span>$L_N$</span> and <span>$L_S$</span> are the total number of synonymous and nonsynonymous sampled alleles, <span>$B(i,n,x)$</span> is the probability of observing a mutation at frequency <span>$i$</span> in <span>$n$</span> sequences when the true allele frequency is <span>$x$</span></p><p>\begin{equation}\label{prf_binom} 	B(i,n,x) = \begin{pmatrix} n \ i \end{pmatrix} x^{i} (1-x)^{n-i} \end{equation}</p><p>\noindent and <span>$H(s,x)$</span> is the time that a new semi dominant mutation with selection coefficient <span>$s$</span> (in the heterozygous) spends between the frequency <span>$x$</span> and the frequency <span>$x+dx$</span> from diffusion theory \citep{wright<em>distribution</em>1938}</p><p>\begin{equation}\label{prf_stationary} 	H(s,x) = \frac{1-e^{-s(1-x)}}{x(1-x)(1-e^{-s})} \end{equation}</p><p>Note that to obtain the expected polymorphic count given the underlying DFE of new mutations equation \eqref{prf<em>pn} should be integrated over the full DFE. Following \citep{eyre-walker</em>estimating_2009}, the underlying DFE for new deleterious mutations is defined by expression <span>$\phi$</span></p><p>\begin{equation}\label{prf_gamma} 	\phi(s;a,b) = a^b s^{b-1} \frac{e^{-a s}}{\Gamma(b)} \end{equation}</p><p>\noindent where <span>$a$</span> and <span>$b$</span> are scale and shape parameters from the Gamma distribution. Therefore, the expected polymorphic count given a particular DFE is defined as</p><p>\begin{equation}\label{prf<em>total</em>pn} 	\mathbf{E}[P<em>{N[i]}] = 2 N</em>e \mu L<em>N \int</em>{-\infty}^{\infty}\int_{0}^{1}B(i,n,x)H(s,x)\phi(s;\alpha,\beta) dx ds \end{equation}</p><p>In addition, the method proposed by \cite{galtier<em>adaptive</em>2016} makes the DFE more flexible by considering that the most appropriate way to model the full DFE may not be the classical Gamma distribution over negative alleles. Therefore, Galtier&#39;s modeling included two different versions of the Fisher&#39;s geometric model, and a model assuming a Beta-shaped distribution of weak effect mutations, instead of a Gamma distribution. However, as explored further in \cite{galtier<em>adaptive</em>2016}, \cite{galtier<em>how</em>2020} and \cite{rousselle<em>is</em>2020}, the shifted negative modeling and the two DFE models based on the Fisher geometric model generally do not perform well in the analysis.</p><p>Following \cite{galtier<em>adaptive</em>2016} and \cite{tataru<em>inference</em>2017} procedure, the expected number of synonymous (<span>$D_S$</span>) and non-synonymous (<span>$D_N$</span>) substitutions can be estimated as</p><p>\begin{equation}\label{prf<em>ds} 	D</em>S = L_S \mu t \end{equation}</p><p>\begin{equation}\label{prf<em>dn} 	\mathbf{E}[D</em>N] = 2 N<em>e \mu L</em>N \int<em>{-\infty}^{\infty} \frac{2s}{1-e^{(-4 N</em>e s)}} \phi(s) ds \end{equation}</p><p>The proportion of adaptive mutations (<span>$\alpha$</span>) is estimated using the ML inference of DFE parameters and the expected counts of non-adaptive mutations. <span>$\alpha$</span> therefore is estimated subtracting the non-adaptive substitutions and neutral substitutions from the total observed divergence counts at selected sites.</p><p>\begin{equation}\label{prf<em>adaptive</em>1} 	\alpha = (d<em>N - d</em>{N}^{na}) / d_N) \end{equation}</p><p>\noindent note that <span>$d_{N}^{na}$</span> is defined following \cite{galtier<em>adaptive</em>2016}. The equation decomposition is similar to the equations shown at \cite{tataru<em>inference</em>2017} and \cite{eyre-walker<em>estimating</em>2009}</p><p>\begin{equation}\label{prf<em>adaptive</em>2} 	d<em>{N}^{na} = \frac{2L</em>N N<em>e \mu \int</em>{-\infty}^{s<em>{adv}} \frac{2s}{1-e^{(-4 Ne s)}} \phi(s) ds}{L</em>N} \end{equation}</p><p>To estimate the non-adaptive substitutions, the approach proposed by \cite{eyre-walker<em>estimating</em>2009} and \cite{tataru<em>inference</em>2017} integrate the DFE from <span>$-\infty \to 0$</span> (<span>$s_{adv} = 0$</span>), taking into account the deleterious fixations and the negative nearly neutral fixations given the DFE. \cite{galtier<em>adaptive</em>2016} considers positive <span>$s_{adv}$</span> values to subtract nearly neutral positive fixations given the <span>$s_{adv}$</span> threshold too.</p><p>\begin{figure}[h] 	\includegraphics[width=1\textwidth]{\dir/introduction/figures/dfe<em>prf.pdf} 	\caption[Expected polymorphic and divergence sites based on PRF]{Expected polymorphic and divergence sites based on PRF approach. Note that for <span>$s=0$</span> the equations became similar to equations \eqref{prf</em>ps} and \eqref{prf<em>ds}. Adapted from \cite{casillas</em>molecular<em>2017}.} 	\label{fig:dfe</em>prf} \end{figure}</p><p>It is important to emphasize that the shape of the SFS may be biased and differ from the previously expected values. The distortion may mainly be due to the effect of demographic events. To account for such distortions, the different methods usually incorporate nuisance parameters following \citep{eyre-walker<em>distribution</em>2006}. The nuisance parameter <span>$r$</span> modifies each frequency of the SFS individually. Thus, <span>$r$</span> modifies the effective mutation rate at each frequency <span>$i$</span>, considering the relative mutation rate at <span>$i$</span> with respect to the mutation rate at singletons \cite{eyre-walker<em>distribution</em>2006}. The perturbing parameter <span>$r_i$</span> considers the same amount of distortion between nonsynonymous and synonymous SFS. Although the assumption is unrealistic, simulations showed that the original correction proposed by \cite{eyre-walker<em>distribution</em>2006} is robust enough to take into account demographic effects. However, other models correct for demographic effects by considering explicit changes in the effective population during the modeling process \citep{eyre-walker<em>estimating</em>2009,zhen<em>greater</em>2021}.</p><p>Despite the efforts for modeling the DFE using polymorphic data, \cite{booker<em>inferring</em>2020} suggested that inferred parameters from ML approaches must be reviewed. Underlying assumptions regarding the DFE shape, selection coefficient strengths, or population sizes can affect the estimations and capture distinct aspects of the DFE \citep{booker<em>inferring</em>2020,zhen<em>greater</em>2021}. Such a situation is plausible in several \textit{D. melanogaster} studies. For example, \cite{campos<em>estimating</em>2017} and \cite{keightley<em>inferring</em>2016} found differences between selection coefficients and probabilities of beneficial alleles. As extensively discussed in \cite{booker<em>inferring</em>2020}, it is plausible due to different methodological assumptions or if the DFE for advantageous mutations is bimodal. This latter case should be especially considered for strongly beneficial alleles, which would be undetectable by analyzing the unfolded SFS (uSFS) \citep{booker<em>inferring</em>2020}.</p><p>\cite{messer<em>population</em>2013} compared the performance of their method -the aMKT- and the \texttt{DFE-alpha} method \citep{eyre-walker<em>estimating</em>2009} through simulations. They claimed that DFE-alpha correctly estimated  when the model allowed for population size change, but the demography inferred was found to be biased, mainly due to background selection acting at linked sites. Genetic draft leaves signatures in the SFS similar to those observed under a recent population size expansion. The DFE-alpha method inferred systematically a population expansion even though no expansion was set in the simulation . Another limitation of PRF approaches is that it becomes computationally intensive, especially when a change in demographic model is applied. Since DFE-alpha can only consider two population-size changes, it becomes insufficient for capturing the excess of rare variants due to the complex demo</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../data/">« Processing data</a><a class="docs-footer-nextpage" href="../empirical/">Empirical estimation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.13 on <span class="colophon-date" title="Tuesday 18 October 2022 23:36">Tuesday 18 October 2022</span>. Using Julia version 1.8.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
