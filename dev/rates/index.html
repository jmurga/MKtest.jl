<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Rates · MKtest.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://jmurga.github.io/MKtest.jl/rates/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MKtest.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Package Overview</span><ul><li><a class="tocitem" href="../analytical/">Analytical estimations</a></li><li><a class="tocitem" href="../data/">Processing data</a></li><li><a class="tocitem" href="../mk/">MK approaches</a></li></ul></li><li><span class="tocitem">Infering the rate and strength of adaptation</span><ul><li><a class="tocitem" href="../empirical/">Empirical estimation</a></li><li class="is-active"><a class="tocitem" href>Rates</a></li><li><a class="tocitem" href="../input/">Input data</a></li><li><a class="tocitem" href="../summstat/">Summary statistics</a></li><li><a class="tocitem" href="../abc/">ABC inference</a></li><li><a class="tocitem" href="../multiple/">Multiple dataset</a></li></ul></li><li><a class="tocitem" href="../cli/">Command-Line interface</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Infering the rate and strength of adaptation</a></li><li class="is-active"><a href>Rates</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Rates</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jmurga/MKtest.jl/blob/master/docs/src/rates.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Estimating-fixation-and-polymorphic-rates-considering-generalized-model-of-selection-and-linkage"><a class="docs-heading-anchor" href="#Estimating-fixation-and-polymorphic-rates-considering-generalized-model-of-selection-and-linkage">Estimating fixation and polymorphic rates considering generalized model of selection and linkage</a><a id="Estimating-fixation-and-polymorphic-rates-considering-generalized-model-of-selection-and-linkage-1"></a><a class="docs-heading-anchor-permalink" href="#Estimating-fixation-and-polymorphic-rates-considering-generalized-model-of-selection-and-linkage" title="Permalink"></a></h1><p>Before executing the rate estimation, you need to load <em>Distributed</em> module and add some threads</p><pre><code class="language-julia hljs">using Distributed
addprocs(7)</code></pre><p>Then you need to declare the <code>MKtest</code> module in all the threads using <code>@everywhere</code> macro. Otherwise, the <code>MKtest</code> module will perform the estimation just using the main core</p><pre><code class="language-julia hljs">@everywhere using MKtest</code></pre><p>Declare a variable containing some basic information about your model. We used a sample size of 661 to perform later analysis over TGP data. The selected Derived Alleles Counts (DAC) will be used to compute summary statistics and perform ABC inference. It is possible to subset any of the selected DAC values when computing summary statistics.</p><pre><code class="language-julia hljs">adap = MKtest.parameters(n=661,dac=[1,2,4,5,10,20,50,100,200,400,500,661,925,1000])</code></pre><p>Note that <code>adap</code> contains about mutation rate, recombination rates, DFE, BGS and probabilities of fixations. To check all the arguments you can access to the function documentation using <code>@doc MKtest.parameter</code></p><pre><code class="language-julia hljs">@doc MKtest.parameter

  Mutable structure containing the variables required to solve the analytical approach. All the functions are solve using the internal values of the structure. For this reason, adap is the
  only exported variable. Adap should be change before the perform the analytical approach, in other case, $\alpha_{(x)}$ will be solve with the default values.

  Parameters
  ≡≡≡≡≡≡≡≡≡≡≡≡

    •  gam_neg::Int64: Selection coefficient for deleterious alleles

    •  gL::Int64: Selection coefficient for weakly benefical alleles

    •  gH::Int64: Selection coefficient for strongly benefical alleles

    •  al_low::Float64: Proportion of α due to weak selection

    •  al_tot::Float64: α

    •  θ_noncoding::Float64: Mutation rate defining BGS strength

    •  θ_coding::Float64: Mutation rate on coding region

    •  al::Float64: DFE shape parameter

    •  be::Float64: DFE scale parameter

    •  B::Float64: BGS strength

    •  B_bins::Array{Float64,1}: BGS values to simulate

    •  ppos_l::Float64: Fixation probabily of weakly beneficial alleles

    •  ppos_h::Float64: Fixation probabily of strongly beneficial alleles

    •  N::Int64: Population size

    •  n::Int64: Sample size

    •  Lf::Int64: Flanking region length

    •  rho::Float64: Recombination rate

    •  TE::Float64</code></pre><p>We will estimate the empirical adaptation rate using TGP data using the estimated DFE parameters at Boyko et al (2008). Nonetheless, shape and scale DFE parameter are flexible in our model.</p><pre><code class="language-julia hljs">adap.al = 0.184
adap.be = abs(0.184/-457)</code></pre><p>Now the variable <code>adap</code> contains sample size, DAC and DFE information. The function <code>MKtest.rates</code> will perform the analytical estimation of <em>N</em> independent models regarding DFE, BGS, mutation rate, and recombination rate. In the following example, we used the function <code>MKtest.rates</code> to input the prior distributions. The function will randomize the input values to solve <em>N</em> independent estimation regarding our model. </p><pre><code class="language-julia hljs">@doc MKtest.rates
  Function to solve randomly N scenarios. The function will create N models, defined by
  MKtest.parameters(), to estimate analytically fixation and polymorphic rates for each
  model. The rates will be used to compute summary statistics required at ABC. The function
  output a HDF5 file containing the solved models, the selected DAC and the analytical
  rates.

  If ρ and/or theta are set to nothing, the function will input random values given the
  range 0.0005:0.0005:0.01. Otherwise you can fix the values.

  If gL is set to nothing, the function will not account the role of the weakly selected
  alleles in the estimation.

  Arguments
  ≡≡≡≡≡≡≡≡≡≡≡

    •  param::parameters: mutable structure containing the model

    •  gH::Array{Int64,1} : Range of strong selection coefficients

    •  gL::Union{Array{Int64,1},Nothing}: Range of weak selection coefficients

    •  gam_neg::Array{Int64,1} : Range of deleterious selection coefficients

    •  theta::Union{Float64,Nothing} : Population-scaled mutation rate on coding region

    •  rho::Union{Float64,Nothing} : Population-scaled recombination rate

    •  iterations::Int64 : Number of solutions

    •  output::String : File to output HDF5 file

  Returns
  ≡≡≡≡≡≡≡≡≡

    •  Array: summary statistics

    •  Output: HDF5 file containing models solved and rates.
</code></pre><pre><code class="language-julia hljs">@time df = MKtest.rates(param = adap,gH=200:2000,gL=1:10,gam_neg=-2000:-200,iterations = 10^5,output=&quot;analysis/rates.jld2&quot;);</code></pre><p>The function will create a HDF5 file containing the solved models, fixation rates, polymorphic rates, and the selected DAC. This information will be used later to estimate summary statistics.</p><p>Note that <a href="../reference/#MKtest.rates"><code>MKtest.rates</code></a> is the most resource and time-consuming function. In our case, the function will estimate 10^5 independent models. Each model solves the estimation for all possible BGS values. We used BGS values from 0.1 to 0.999 in 5% increments. In total, the example will produce 3.7 million estimates. We have used a hierarchical data structure (HDF5) to facilitate model parameters and rates storage.</p><p>The following example took about 1.5 hours to execute on the hardware described at section <a href="../empirical/">Infering the rate and strength of adaptation</a></p><p>If you have a system with few resources, it is possible <a href="https://imkt.uab.cat/files/inputs/rates.jld2">to download pre-computed TGP and DGN data rates</a>. Please go to the next section to continue the inference using the pre-computed rates.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../empirical/">« Empirical estimation</a><a class="docs-footer-nextpage" href="../input/">Input data »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.13 on <span class="colophon-date" title="Tuesday 24 May 2022 16:33">Tuesday 24 May 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
