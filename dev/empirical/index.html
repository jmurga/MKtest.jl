<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Empirical estimation · MKtest.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://jmurga.github.io/MKtest.jl/empirical/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MKtest.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Package Overview</span><ul><li><a class="tocitem" href="../analytical/">Analytical estimations</a></li><li><a class="tocitem" href="../data/">Processing data</a></li><li><a class="tocitem" href="../mk/">MK approaches</a></li></ul></li><li><span class="tocitem">Infering the rate and strength of adaptation</span><ul><li class="is-active"><a class="tocitem" href>Empirical estimation</a><ul class="internal"><li><a class="tocitem" href="#Extending-analytical-estimations"><span>Extending analytical estimations</span></a></li><li><a class="tocitem" href="#Summary-statistics"><span>Summary statistics</span></a></li><li><a class="tocitem" href="#Parameters-inference"><span>Parameters inference</span></a></li><li class="toplevel"><a class="tocitem" href="#Computational-pipeline"><span>Computational pipeline</span></a></li></ul></li><li><a class="tocitem" href="../rates/">Rates</a></li><li><a class="tocitem" href="../input/">Input data</a></li><li><a class="tocitem" href="../summstat/">Summary statistics</a></li><li><a class="tocitem" href="../abc/">ABC inference</a></li><li><a class="tocitem" href="../multiple/">Multiple dataset</a></li></ul></li><li><a class="tocitem" href="../cli/">Command-Line interface</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Infering the rate and strength of adaptation</a></li><li class="is-active"><a href>Empirical estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Empirical estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jmurga/MKtest.jl/blob/master/docs/src/empirical.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Infering-the-rate-and-strength-of-adaptation"><a class="docs-heading-anchor" href="#Infering-the-rate-and-strength-of-adaptation">Infering the rate and strength of adaptation</a><a id="Infering-the-rate-and-strength-of-adaptation-1"></a><a class="docs-heading-anchor-permalink" href="#Infering-the-rate-and-strength-of-adaptation" title="Permalink"></a></h1><p>We develop an extension of the analytical approximation presented in Uricchio, Petrov, and Enard (2019). In the previous paper, analytical calculations were used to explore the effect of BGS on weakly beneficial alleles, but the estimation procedure employed was based on computationally intensive simulations. While inference procedures based on forward simulations allow for the inclusion of complex demographic histories, they often require high-performance computing resources and can be prohibitively slow for some models. Here we extend Uricchio, Petrov and Enard (2019) analytical approximations to develop a simple and computationally efficient ABC-based inference procedure. Our method accounts for the DFE of deleterious and beneficial alleles and incomplete recombination between selected genomic elements. </p><p>To perform the empirical estimation of <span>$\alpha_{(x)}$</span> we followed a generic ABC algorithm (Beaumont et al 2002). ABC proceeds by first sampling parameter values from prior distributions, the next simulating model using these parameter values, calculating informative summary statistics, and comparing the simulated summary statistics to the observed data. Considering the standard ABC scheme, we (1) considered <span>$N$</span> random combinations from prior distributions; (2) solved <span>$N$</span> independent models to generate informative summary statistics; (3) subset the parameter values producing summary statistics that best match the observed data from an approximate posterior distribution. Additionally, a linear model can be imposed to correct the non-0 distance between the simulated and observed summary statistics.</p><h2 id="Extending-analytical-estimations"><a class="docs-heading-anchor" href="#Extending-analytical-estimations">Extending analytical estimations</a><a id="Extending-analytical-estimations-1"></a><a class="docs-heading-anchor-permalink" href="#Extending-analytical-estimations" title="Permalink"></a></h2><p>We extended the analytical calculations solving <span>$N$</span> independents models. We automatize the analytical estimations to input prior distributions. </p><p>The models will be solved using random combinations from prior distributions. Fixation, polymorphic rates, and model information will be used to estimate informative summary statistics needed to perform ABC inference. Please see section <a href="../rates/">rates</a> to check how to input prior distributions.</p><h2 id="Summary-statistics"><a class="docs-heading-anchor" href="#Summary-statistics">Summary statistics</a><a id="Summary-statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Summary-statistics" title="Permalink"></a></h2><p>\cite{uricchio<em>exploiting</em>2019} used the analytical theory to demonstrate the effect of weakly beneficial alleles at <span>$\alpha_{(x)}$</span>. To do that, they solved <span>$\alpha_{(x)}$</span> through the fixation and polymorphism rates since the locus length (<span>$L$</span>) and the time branch (<span>$T$</span>) estimations at first order <span>$\alpha_{(x)}$</span> estimation can be canceled</p><p class="math-container">\[\mathbb{E}[\alpha_{(x)}] \approx 1 - \frac{LT(\mathbb{E}[d_S])}{LT(\mathbb{E}[d_N])} \frac{LT(\mathbb{E}[p_{S(x)}])}{LT(\mathbb{E}[p_{N(x)}])} \approx 1 - \frac{\mathbb{E}[d_S]}{\mathbb{E}[d_N]} \frac{\mathbb{E}[p_{S(x)}]}{\mathbb{E}[p_{N(x)}]}\]</p><p>where <span>$\frac{LT}{LT}$</span> with a constant mutation rate tend to <span>$1$</span>. </p><p>Here, we extended their analytical calculations to generate the summary statistics required at ABC approaches. Thereby we avoided expensive forward simulations. </p><p>Considering fixed values of <span>$T$</span>, <span>$L$</span>, <span>$\mu$</span>, and fixation rates it is possible to solve analytical <span>$\alpha_{(x)}$</span> performing the multiplication. However, this requires not only branch length estimations but also explicitly locus length selection which highly increases the order of estimations to solve. To avoid branch length estimations and locus length selection, we follow the previously described assumptions: (1) empirically observed fixations should be proportional to <span>$T$</span>, <span>$L$</span> and <span>$\mu$</span>; (2) the mutational process follows a Poisson distribution . Based on that premises, we used a Poisson-sampling process to estimate the expected number of fixations. We corrected the analytical expected rates by the empirical observations as the rate of success <span>$\lambda$</span> on the Poisson distribution</p><p class="math-container">\[\mathbb{E}[D] = X \in Poisson\left(\lambda = D_{observed} \times (\mathbb{E}[d_+]+\mathbb{E}[d_-]+\mathbb{E}[d_0])\right)\]</p><p>To estimate <span>$\alpha_{(x)}$</span> we draw the expected values considering each fixation category. We sampled the values in two categories according to the relative rates. Following the same procedure:</p><p class="math-container">\[\mathbb{E}[D_S] = X \in Poisson\left(\lambda = D_{observed} \times \left[\frac{\mathbb{E}[d_0]}{\mathbb{E}[d_+] + \mathbb{E}[d_-] + \mathbb{E}[d_0]}\right]\right)\]</p><p class="math-container">\[\mathbb{E}[D_N] = X \in Poisson\left(\lambda = D_{observed} \times \left[\frac{\mathbb{E}[d_+] + \mathbb{E}[d_-]}{\mathbb{E}[d_+] + \mathbb{E}[d_-] + \mathbb{E}[d_0]}\right]\right)\]</p><p>Our model takes into account that both sampling variance and process variance should affect the number of variable alleles that we sample at any particular allele frequency. The process variance arises from the random mutation-fixation process along the branch. To incorporate that variance we made one sample per frequency-bin given the SFS. Considering the random process at each frequency we made credible intervals for future ABC estimations. Otherwise, we would falsely find higher confidence in our parameter estimates. We draw the expected polymorphic values similarly to fixations, considering the SFS and the expected rates.</p><p class="math-container">\[\mathbb{E}[P] = \sum_{x=0}^{x=1} X \in Poisson\left(\lambda = SFS_{(x)\ observed} \times (\mathbb{E}[p_{+(x)}]+\mathbb{E}[p_{-(x)}]+\mathbb{E}[p_{0(x)}])\right)\]</p><p>We modified the expected polymorphic rates and the observed SFS considering each frequency <span>$x$</span> as the cumulative sum above <span>$x$</span>. This quantities have the same asymptote but are less affected by changing sample size. Therefore, we scaled better the analysis to sample size since most common alleles at frequencies <span>$x$</span> have very few polymorphic sites in large samples. This way, we finally transformed <span>$\alpha_{(x)}$</span> to be depending on the previous frequency bin value, which reflects each frequency category over the expected asymptotic shape. Because of that, <span>$\alpha_{(x)}$</span> analysis is more robust even in low polymorphic populations.</p><p>Consequently, for each analytical combination, it is possible to sample the expected number of fixations and polymorphism to perform the <span>$\alpha_{(x)}$</span> estimations. Like in \cite{uricchio<em>exploiting</em>2019} we input <span>$\alpha_{(x)}$</span> as summary statistic at generic ABC algorithm. We exploited summary statistics selection that are informative for estimating <span>$\alpha_{(x)}$</span> values.</p><h2 id="Parameters-inference"><a class="docs-heading-anchor" href="#Parameters-inference">Parameters inference</a><a id="Parameters-inference-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters-inference" title="Permalink"></a></h2><p>We used the expected proportion of weakly and strong fixations to estimate <span>$\alpha_W$</span>, <span>$\alpha_S$</span> and <span>$\alpha$</span>. We followed the same procedure as the above section to subset the expected number of fixation taking into account weakly, strong and deleterious fixation rates categories. Therefore, we modified \hyperref[eqn 19]{eqn 19} according to their relative fixation rates.</p><p class="math-container">\[\mathbb{E}[D_W] = X \in Poisson\left(\lambda = D_{observed} \times \left[\frac{\mathbb{E}[d_W]}{\mathbb{E}[d_+] + \mathbb{E}[d_-] + \mathbb{E}[d_0]}\right]\right)\]</p><p class="math-container">\[\mathbb{E}[D_S] = X \in Poisson\left(\lambda = D_{observed} \times \left[\frac{\mathbb{E}[d_S]}{\mathbb{E}[d_+] + \mathbb{E}[d_-] + \mathbb{E}[d_0]}\right]\right)\]</p><p>In addition, for each model, we retrieve negative selection coefficients and shape parameter to perform ABC inference.</p><h1 id="Computational-pipeline"><a class="docs-heading-anchor" href="#Computational-pipeline">Computational pipeline</a><a id="Computational-pipeline-1"></a><a class="docs-heading-anchor-permalink" href="#Computational-pipeline" title="Permalink"></a></h1><p>The following sections describe a pipeline to estimate the empirical adaptation rate (<span>$\alpha$</span>) using whole-genome protein, Viral Interacting Proteins and Non-Viral Interacting Protein data from the TGP. This analysis is similar to the one performed at Uricchio et. al (2019). We divided the pipeline into the following step:</p><ul><li>MKtest estimations</li><li>Empirical data parse</li><li>Summary statistic estimation</li><li>ABC inference</li></ul><p>Please note that we use a relative path called <em>analysis/</em> to execute the whole pipeline. This path will be relative to the where Julia or the Command-Line Interface is executed.</p><p>The software is prepared to parallelize each pipeline step using Julia <a href="https://docs.julialang.org/en/v1/manual/distributed-computing/">Distributed</a> computing. Distributing the process into threads has a cost in RAM. Please make some tests in your machine before executing expensive models. Nonetheless, distributing the estimation into threads decreases the pipeline execution time. It is almost mandatory to parallelize at least the rate estimations.</p><p>The following examples, as well as the analysis described at REF, were tested using a laptop with the following hardware:</p><ul><li>Intel i7-7700HQ (8) @ 3.800GHz </li><li>16GB RAM DDR4 2400MHz</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mk/">« MK approaches</a><a class="docs-footer-nextpage" href="../rates/">Rates »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.13 on <span class="colophon-date" title="Tuesday 24 May 2022 09:57">Tuesday 24 May 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
